# 数学A: 確率 (2) 独立試行と反復試行 (Session 29)

**対象**: 社会人エンジニア (Rust/Go)
**学習目標**: 独立試行の確率（積の法則）と反復試行の確率（二項分布の基礎）を習得し、ベルヌーイ試行のモデル化能力を養う。

---

## Phase 1: Foundational Check (基礎確認 10問)

**指針**: 「困ったときは『定義』に還れ」。試行Aの結果が試行Bに影響を与えないとき、それらは独立である。

1.  **[独立試行の定義]** サイコロを2回投げるとき、1回目に偶数が出ることと、2回目に奇数が出ることは独立か。

2.  **[独立試行の確率]** サイコロを2回投げるとき、1回目に偶数、2回目に奇数が出る確率を求めよ。
    > **Formula**: $P(A \cap B) = P(A) \times P(B)$。

3.  **[反復試行の公式]** 確率 $p$ で起こる事象が、 $n$ 回の独立な試行のうちちょうど $k$ 回起こる確率 $_nC_k p^k (1-p)^{n-k}$ を何というか。
    > **Term**: 二項分布 (Binomial Distribution) の確率質量関数。

4.  **[反復試行]** コインを3回投げるとき、表がちょうど2回出る確率を求めよ。
    > **Calculation**: $_3C_2 (1/2)^2 (1/2)^1$。

5.  **[反復試行]** サイコロを3回投げるとき、1の目がちょうど1回出る確率を求めよ。
    > **Calculation**: $_3C_1 (1/6)^1 (5/6)^2$。

6.  **[少なくとも1回]** サイコロを3回投げるとき、1の目が少なくとも1回出る確率を求めよ。
    > **Maxim**: 「『少なくとも』は『余事象』を疑え」。 $1 - (5/6)^3$。

7.  **[独立性の判定]** 袋の中に赤玉3個、白玉2個が入っている。
    (a) 玉を1個取り出し、戻してからもう1個取り出す。
    (b) 玉を1個取り出し、戻さずにもう1個取り出す。
    独立試行であるのはどちらか。

8.  **[確率の最大値]** コインを100回投げるとき、表が出る回数として最も確率が高いのは何回か。
    > **Intuition**: 期待値 $np$ 付近。

9.  **[幾何分布]** サイコロを投げ続け、初めて1が出るのが3回目である確率を求めよ。
    > **Formula**: $(1-p)^{k-1} p$。

10. **[プログラミング]** 成功確率 $p$ の試行を $n$ 回行ったときの成功回数をシミュレーションする関数 `binomial(n, p)` の実装アイデアを述べよ。
    > **Algorithm**: `bernoulli(p)` を $n$ 回呼び出してカウントする。

---

## Phase 2: Applied Mastery (応用・実践 10問)

**指針**: 「『解き方』は一つにあらず」。複雑な事象を、単純な独立試行の組み合わせ（AND/OR）に分解せよ。

11. **[勝負の確率]**
    A, Bの2人がゲームをし、先に3勝した方が優勝とする。1回のゲームでAが勝つ確率は $2/3$ （引き分けなし）である。
    3勝0敗でAが優勝する確率を求めよ。

12. **[勝負の確率（もつれ込み）]**
    前問において、Aが3勝2敗で優勝する確率を求めよ。
    > **Logic**: 4戦目までにAが2勝2敗となり、5戦目でAが勝つ。
    > $_4C_2 (2/3)^2 (1/3)^2 \times (2/3)$。

13. **[点の移動]**
    数直線上の原点にある点Pが、コインを投げて表なら $+1$、裏なら $-1$ 進む。
    コインを4回投げたとき、点Pが原点に戻っている確率を求めよ。
    > **Logic**: 表2回、裏2回の場合。

14. **[点の移動（平面）]**
    $xy$ 平面上の原点にある点Pが、サイコロを投げて
    1, 2なら $x$ 軸正方向に $+1$
    3, 4なら $y$ 軸正方向に $+1$
    5, 6なら動かない
    とする。3回投げた後、点Pが $(2, 1)$ にある確率を求めよ。
    > **Formula**: 多項分布。 $3! / (2! 1! 0!) \times (1/3)^2 (1/3)^1 (1/3)^0$。

15. **[3つの事象の独立]**
    3つの事象A, B, Cが互いに独立であるための条件を述べよ。
    > **Tip**: $P(A \cap B) = P(A)P(B)$ などペアごとの独立だけでなく、 $P(A \cap B \cap C) = P(A)P(B)P(C)$ も必要。

16. **[システム信頼性]**
    稼働率 $p=0.9$ のサーバーを2台並列（冗長構成）にしたとき、システム全体が稼働（少なくとも1台が稼働）している確率はいくらか。
    > **Prog Link**: 可用性 (Availability) 計算。 $1 - (1-p)^2$。

17. **[直列システムの信頼性]**
    稼働率 $p=0.9$ のコンポーネントを3つ直列につないだシステムが稼働する確率はいくらか。
    > **Prog Link**: $p^3$。直列は弱くなる。

18. **[バグの発見]**
    あるプログラムにバグがある確率は $0.8$ である。
    バグがある場合、テストで検出できる確率は $0.7$ である。
    テストを2回行って、少なくとも1回バグが検出される確率を求めよ（バグがあることは前提とせず、バグが存在し、かつ検出される確率）。
    > **Logic**: (バグあり) AND ( (1回目検出) OR (2回目検出) )。

19. **[無限回の試行]** (発展)
    A, Bが交互にサイコロを投げ、先に1を出した方が勝ちとする。先攻Aが勝つ確率を求めよ。
    > **Formula**: 無限等比級数の和。 $p + (1-p)^2 p + (1-p)^4 p + \dots$。

20. **[プログラミング: エラー再送]**
    通信パケットが消失する確率が $p=0.1$ のとき、再送回数の期待値はいくつか。
    > **Formula**: 幾何分布の期待値 $1/p$ ではなく、成功までの試行回数期待値 $1/(1-p)$。
    > （成功確率 $q=0.9$ なので $1/0.9 \approx 1.11$ 回）

---

## 解答と解説

### Phase 1

1.  **独立である**
2.  **1/4**
    *   $1/2 \times 1/2 = 1/4$。
3.  **二項分布の確率（反復試行の確率）**
4.  **3/8**
    *   $3 \times (1/4) \times (1/2) = 3/8$。
5.  **25/72**
    *   $3 \times (1/6) \times (25/36) = 75/216 = 25/72$。
6.  **91/216**
    *   $1 - (5/6)^3 = 1 - 125/216 = 91/216$。
7.  **a (戻す)**
    *   復元抽出は独立。非復元抽出は従属。
8.  **50回**
9.  **25/216**
    *   $(5/6)^2 \times (1/6) = 25/216$。
10. **解説**
    *   `count = 0; for _ in 0..n { if bernoulli(p) { count += 1 } }`

### Phase 2

11. **8/27**
    *   $(2/3)^3 = 8/27$。
12. **16/81**
    *   4戦目まで2勝2敗: $_4C_2 (2/3)^2 (1/3)^2 = 6 \times 4/9 \times 1/9 = 24/81 = 8/27$。
    *   5戦目勝ち: $8/27 \times 2/3 = 16/81$。
13. **3/8**
    *   $_4C_2 (1/2)^4 = 6/16 = 3/8$。
14. **1/9**
    *   $x$移動(1/3), $y$移動(1/3), 不動(1/3)。
    *   $(2, 1)$ になるには $x$移動2回、 $y$移動1回。
    *   $3!/(2!1!0!) \times (1/3)^2 (1/3)^1 (1/3)^0 = 3 \times 1/27 = 1/9$。
15. **解説**
    *   $P(A \cap B) = P(A)P(B)$
    *   $P(B \cap C) = P(B)P(C)$
    *   $P(C \cap A) = P(C)P(A)$
    *   $P(A \cap B \cap C) = P(A)P(B)P(C)$
    *   これら全てが必要。
16. **0.99**
    *   $1 - (0.1)^2 = 1 - 0.01 = 0.99$。
17. **0.729**
    *   $0.9^3 = 0.729$。
18. **0.728**
    *   バグあり(0.8)。
    *   2回とも見逃す確率 $(0.3)^2 = 0.09$。
    *   少なくとも1回検出(バグあり前提) $1 - 0.09 = 0.91$。
    *   全体確率 $0.8 \times 0.91 = 0.728$。
19. **6/11**
    *   $p=1/6$。 $r=(5/6)^2=25/36$。
    *   初項 $1/6$、公比 $25/36$ の無限等比級数。
    *   $(1/6) / (1 - 25/36) = (1/6) / (11/36) = 6/11$。
20. **約 1.11回**
    *   成功確率 $q = 1-p = 0.9$。
    *   平均試行回数 $1/q = 1/0.9 \approx 1.11$。

