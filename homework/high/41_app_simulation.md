# 数学総合応用 (1) シミュレーションと確率 (Session 41)

**対象**: 社会人エンジニア (Rust/Go)
**学習目標**: 確率・統計の知識を応用し、モンテカルロ法による数値計算やリスク評価のシミュレーション手法を習得する。

---

## Phase 1: Foundational Check (理論的背景 10問)

**指針**: シミュレーションの背後にある数学的原理（大数の法則、期待値、幾何学的確率）を確認せよ。

1.  **[大数の法則]** 試行回数 $n$ を無限に大きくするとき、相対度数 $r/n$ は何に収束するか。
    > **Term**: 数学的確率 $P$。

2.  **[幾何学的確率]** 一辺の長さ 2 の正方形の中に、半径 1 の円が内接している。この正方形内にランダムに点を打つとき、点が円の内部に入る確率はいくらか。
    > **Calculation**: $\pi / 4$。

3.  **[期待値の線形性]** 確率変数 $X, Y$ について、 $E[X+Y]$ は常に $E[X] + E[Y]$ に等しいか。
    > **Logic**: 独立性に関わらず常に等しい。

4.  **[分散の加法性]** 確率変数 $X, Y$ が独立であるとき、 $V(X+Y)$ は何に等しいか。
    > **Formula**: $V(X) + V(Y)$。

5.  **[二項分布の近似]** 試行回数 $n$ が十分に大きいとき、二項分布 $B(n, p)$ はどのような分布に近似できるか。
    > **Term**: 正規分布 $N(np, np(1-p))$。

6.  **[乱数]** コンピュータで生成される乱数は、厳密には乱数ではない。これを何というか。
    > **Term**: 擬似乱数 (Pseudo-random numbers)。

7.  **[一様乱数]** 区間 $[0, 1]$ の一様乱数 $U$ がある。 $a \le X \le b$ の一様乱数 $X$ を $U$ を用いて表せ。
    > **Formula**: $X = a + (b-a)U$。

8.  **[棄却法]** 領域 $D$ 内のランダムな点を得るために、 $D$ を含む単純な領域（長方形など）で点を生成し、 $D$ に含まれないものを捨てる手法を何というか。
    > **Term**: 棄却法 (Rejection Sampling)。

9.  **[ランダムウォーク]** 数直線上を確率 $1/2$ で $\pm 1$ 移動する点を考える。 $n$ ステップ後の位置の期待値はいくらか。
    > **Calculation**: $0$。

10. **[プログラミング]** `rand.Float64()` (Go) や `rng.gen::<f64>()` (Rust) が返す値の範囲は通常どこか。
    > **Spec**: $[0.0, 1.0)$ （半開区間）。

---

## Phase 2: Applied Mastery (実践シミュレーション 10問)

**指針**: 数式で解ける問題をあえてシミュレーションで解く、あるいは数式で解くのが困難な問題をシミュレーションで近似する。

11. **[円周率の近似]**
    モンテカルロ法を用いて円周率 $\pi$ を求めるアルゴリズムを記述せよ。
    > **Algorithm**: 正方形内に $N$ 個の点を打ち、円内の点 $M$ 個を数える。 $\pi \approx 4M/N$。

12. **[定積分の近似]**
    $\int_0^1 x^2 dx$ の値をモンテカルロ法で求めるには、どのような領域で点を生成し、何を数えればよいか。
    > **Algorithm**: $0 \le x \le 1, 0 \le y \le 1$ の正方形内で、 $y \le x^2$ となる点の割合を求める。

13. **[ガチャのコンプリート]**
    全 $n$ 種類のアイテムが等確率で出るガチャがある。全種類揃えるために必要な回数の期待値を数式で表せ（クーポンコレクター問題）。
    > **Formula**: $n \sum_{k=1}^n \frac{1}{k} \approx n \ln n$。

14. **[ランダムウォークの分散]**
    数直線上を $\pm 1$ 移動するランダムウォークにおいて、 $n$ ステップ後の位置の分散を求めよ。
    > **Calculation**: 各ステップの分散は $1$。独立なので $n$ ステップ後は $n$。標準偏差は $\sqrt{n}$。

15. **[破産問題]**
    A君の持ち点は10、B君の持ち点は10。コインを投げて表ならAが+1 (Bから奪う)、裏ならAが-1 (Bに渡す)。どちらかの持ち点が0になったら終了する。A君が勝つ（Bを0にする）確率はいくらか。
    > **Logic**: 対称性より $1/2$。

16. **[モンティ・ホール・シミュレーション]**
    モンティ・ホール問題をシミュレーションする際、以下の手順の誤りを指摘せよ。
    1. 正解ドアをランダムに決める。
    2. プレイヤーが選ぶドアをランダムに決める。
    3. 残りのドアからランダムに1つ開ける。
    4. 開けたドアが正解でなければ、変えた場合の結果を記録する。
    > **Correction**: 手順3で「司会者は必ずハズレのドアを開ける」という条件が必要。ランダムに開けて正解が出てしまったケースを除外（条件付き確率）すると結果が変わる可能性があるが、司会者の意図（正解を知っていて避ける）を反映すべき。

17. **[バグ混入シミュレーション]**
    あるシステムは1日あたり確率 $p$ で故障する。 $N$ 日間稼働させたとき、一度も故障しない確率をシミュレーションで求める関数のシグネチャとロジック概要を記述せよ。
    > **Code**: `simulate_reliability(days: int, p: float, trials: int) -> float`。

18. **[待ち行列]** (発展)
    ある窓口に1分あたり平均 $\lambda$ 人が到着し、サービスに平均 $\mu$ 分かかるとする。待ち行列の長さをシミュレーションしたい。どのような乱数分布を用いるのが適切か。
    > **Math**: 到着間隔は指数分布、サービス時間も指数分布（M/M/1モデルの場合）。ポアソン分布との関係。

19. **[数値誤差]**
    モンテカルロ法で精度を1桁上げる（誤差を1/10にする）ためには、試行回数を何倍にする必要があるか。
    > **Theory**: 誤差は $1/\sqrt{N}$ に比例するため、100倍にする必要がある。

20. **[プログラミング: 並列化]**
    モンテカルロ・シミュレーションは並列化に適しているか。その理由を「独立性」の観点から述べよ。
    > **Tech**: 非常に適している（Embarrassingly Parallel）。各試行が独立しており、通信が不要なため。

---

## 解答と解説

### Phase 1

1.  **数学的確率**
2.  **$\pi / 4$**
3.  **等しい**
4.  **$V(X) + V(Y)$**
5.  **正規分布**
6.  **擬似乱数**
7.  **$X = a + (b-a)U$**
8.  **棄却法**
9.  **0**
10. **$[0.0, 1.0)$**

### Phase 2

11. **解説参照**
12. **解説参照**
    *   正方形面積1。 $y \le x^2$ の面積が積分値。
13. **$n(1 + 1/2 + \dots + 1/n)$**
14. **$n$**
15. **1/2**
16. **司会者は意図的にハズレを開ける**
17. **解説**
    *   `success_count = 0`
    *   `for _ in 0..trials:`
        *   `failed = false`
        *   `for _ in 0..days:`
            *   `if rand() < p: failed = true; break`
        *   `if !failed: success_count += 1`
    *   `return success_count / trials`
18. **指数分布**
19. **100倍**
20. **適している**

