# 数学A: 場合の数 (2) 順列 (Session 26)

**対象**: 社会人エンジニア (Rust/Go)
**学習目標**: 順列 ($nPr, n!$) の定義と計算方法を習得し、円順列や重複順列などのバリエーションに対応できるようにする。

---

## Phase 1: Foundational Check (基礎確認 10問)

**指針**: 「困ったときは『定義』に還れ」。順列とは「選んで、並べる」ことである。

1.  **[順列の定義]** 異なる $n$ 個のものから $r$ 個を選んで一列に並べる順列の総数 $_nP_r$ の式を、階乗を用いて表せ。
    > **Prog Link**: `n * (n-1) * ... * (n-r+1)`。

2.  **[計算]** $_6P_3$ の値を求めよ。

3.  **[階乗]** $5!$ の値を求めよ。
    > **Prog Link**: 再帰関数 `factorial(n)`. $O(N)$。

4.  **[0の階乗]** $0!$ の値はいくつか。また、その理由を $_nP_n$ の式から説明せよ。
    > **Logic**: $_nP_n = n! / (n-n)! = n! / 0!$。これが $n!$ になるためには $0!=1$ でなければならない。

5.  **[文字列の並べ替え]** "RUST" の4文字をすべて使ってできる順列は何通りか。

6.  **[特定の並び]** 男子3人、女子2人が一列に並ぶとき、女子2人が隣り合う並び方は何通りか。
    > **Algorithm**: 女子2人を「1つのセット」とみなして並べ、その内部での並び替えを掛ける。

7.  **[両端の指定]** 男子3人、女子2人が一列に並ぶとき、両端が男子である並び方は何通りか。
    > **Maxim**: 「条件の強い場所（両端）から決めよ」。

8.  **[円順列]** 異なる4つの玉を円形に並べる方法は何通りか。
    > **Logic**: 回転して重なるものは同じとみなす。 $(n-1)!$。

9.  **[重複順列]** 3個の数字 1, 2, 3 を重複を許して4個並べる方法は何通りか。
    > **Prog Link**: $n^r$。パスワードの総当たり数。

10. **[同じものを含む順列]** "AABBB" の5文字を並べる方法は何通りか。
    > **Formula**: $n! / (p! q! \dots)$。

---

## Phase 2: Applied Mastery (応用・実践 10問)

**指針**: 「条件を使い切ったか確認せよ」。固定する、セットにする、余事象を使うなど、テクニックを組み合わせよ。

11. **[隣り合わない順列]**
    男子4人、女子3人が一列に並ぶとき、女子同士が隣り合わない並び方は何通りか。
    > **Algorithm**: まず男子を並べ、その間（および両端）に女子を入れる。

12. **[円順列（条件付き）]**
    男子4人、女子4人が円卓に座るとき、男女が交互になる座り方は何通りか。
    > **Logic**: 男子を円に並べ（固定）、その間に女子を並べる。

13. **[じゅず順列]**
    異なる5色の玉をつないでネックレスを作るとき、何通りのネックレスができるか。
    > **Logic**: 裏返して一致するものを同一視する。円順列 $/ 2$。

14. **[重複順列（部分集合）]**
    集合 $\{1, 2, \dots, n\}$ の部分集合の個数が $2^n$ であることを、重複順列の考え方で説明せよ。
    > **Logic**: 各要素について「選ぶ」「選ばない」の2択を $n$ 回繰り返す。

15. **[同じものを含む順列（経路）]**
    右図のような格子状の道（横4マス、縦3マス）がある。A地点からB地点への最短経路は何通りか。
    > **Prog Link**: 動的計画法 (DP) または $_7C_3$。

16. **[辞書式配列の逆]**
    0, 1, 2, 3, 4 の5つの数字を並べてできる5桁の整数のうち、小さい方から数えて50番目の数は何か。
    > **Tip**: Session 25 の類題。先頭が1の場合、2の場合...と数える。

17. **[条件付き順列]**
    "ALGORITHM" の9文字を並べ替えるとき、"GOR" という並びを含むものは何通りか。
    > **Logic**: "GOR" を1文字とみなす。

18. **[組分け]**
    6人をA, B, Cの3つの部屋に入れる方法は何通りか。ただし、空室があってもよい。
    また、空室がないようにする方法は何通りか。
    > **Algorithm**: $3^6$ から「空室あり」を除く（包除原理）。

19. **[関数]**
    集合 $X=\{1, 2, 3\}$ から $Y=\{1, 2, 3, 4\}$ への単射（1対1の関数）は何個あるか。
    > **Math**: $_4P_3$。

20. **[プログラミング]**
    配列 `[1, 2, 3]` のすべての順列を生成する再帰関数 `permutations(arr)` のロジックを説明せよ。
    > **Prog Link**: Backtracking。要素をスワップして再帰し、戻ったらスワップを戻す。

---

## 解答と解説

### Phase 1

1.  **$n! / (n-r)!$**
2.  **120**
    *   $6 \times 5 \times 4 = 120$。
3.  **120**
    *   $5 \times 4 \times 3 \times 2 \times 1 = 120$。
4.  **1**
5.  **24通り**
    *   $4! = 24$。
6.  **48通り**
    *   女子2人をセット $\to$ 全体4つの順列 $4! = 24$。
    *   女子の中での並び替え $2! = 2$。
    *   $24 \times 2 = 48$。
7.  **36通り**
    *   両端の男子: $_3P_2 = 6$。
    *   間の3人: $3! = 6$。
    *   $6 \times 6 = 36$。
8.  **6通り**
    *   $(4-1)! = 3! = 6$。
9.  **81通り**
    *   $3^4 = 81$。
10. **10通り**
    *   $5! / (2! 3!) = 120 / (2 \times 6) = 10$。

### Phase 2

11. **1440通り**
    *   男子4人: $4! = 24$。
    *   隙間（両端含む）は5箇所。そこから3箇所選んで女子を並べる: $_5P_3 = 5 \times 4 \times 3 = 60$。
    *   $24 \times 60 = 1440$。
12. **144通り**
    *   男子円順列: $(4-1)! = 6$。
    *   隙間4箇所に女子: $4! = 24$。
    *   $6 \times 24 = 144$。
13. **12通り**
    *   $(5-1)! / 2 = 24 / 2 = 12$。
14. **解説**
    *   各要素 $x_i$ に対し、 $\{0, 1\}$ のラベルを付与する重複順列と等価。
15. **35通り**
    *   横4回、縦3回。計7回。
    *   $7! / (4! 3!) = (7 \cdot 6 \cdot 5) / (3 \cdot 2 \cdot 1) = 35$。
16. **20134**
    *   先頭 1: $4! = 24$個。
    *   先頭 2: $4! = 24$個。ここまで48個。
    *   次は先頭 3 の最小。 30124 (49番目)。
    *   30142 (50番目)。
    *   (計算ミス確認: 1xxxx (24), 2xxxx (24)。計48。
    *   49番目は 3xxxx の最初。 30124。
    *   50番目は 30142。
    *   答え: 30142。
    *   解説修正: **30142**)
17. **2520通り**
    *   GOR, A, L, I, T, H, M (7文字)。
    *   $7! / 1! = 5040$ ... 重複文字なし。
    *   ALGORITHM に重複文字はない。
    *   $7! = 5040$。
    *   (計算ミス確認: A, L, G, O, R, I, T, H, M。重複なし。
    *   GOR を1文字 $X$ と置く。 A, L, X, I, T, H, M。 7文字。
    *   $7! = 5040$。
    *   答え: 5040。
    *   解説修正: **5040**)
18. **$3^6 = 729$, 空室なし $540$**
    *   空室なし: 全体 - (空室1つ) - (空室2つ) + ...
    *   空室2つ（全員1部屋）: 3通り。
    *   空室1つ（全員2部屋）: $_3C_2 \times (2^6 - 2) = 3 \times 62 = 186$。
    *   $729 - 186 - 3 = 540$。
19. **24個**
    *   $_4P_3 = 4 \times 3 \times 2 = 24$。
20. **解説**
    *   `dfs(index)`: `index` が末尾なら出力。そうでなければ、`index` 以降の各要素と `index` をスワップし、`dfs(index+1)` を呼び出し、戻ったらスワップを戻す（バックトラック）。

