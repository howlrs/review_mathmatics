# 数学総合応用 (4) 暗号と符号理論 (Session 44)

**対象**: 社会人エンジニア (Rust/Go)
**学習目標**: 整数の性質（ユークリッドの互除法、合同式）と多項式演算を応用し、RSA暗号や誤り訂正符号の数学的原理を理解する。

---

## Phase 1: Foundational Check (理論的背景 10問)

**指針**: 暗号理論の基礎は「整数論」にある。素数、剰余、互いに素といった概念を復習せよ。

1.  **[ユークリッドの互除法]** 2つの整数 $a, b$ の最大公約数 $\gcd(a, b)$ を求めるアルゴリズムの手順を簡潔に述べよ。
    > **Algorithm**: $a$ を $b$ で割った余りを $r$ とし、 $\gcd(b, r)$ を求めることを繰り返す。

2.  **[互いに素]** 2つの整数 $a, b$ が「互いに素」であるとは、 $\gcd(a, b)$ がいくつであることを意味するか。
    > **Value**: 1。

3.  **[合同式]** $a \equiv b \pmod n$ の定義を述べよ。
    > **Def**: $a - b$ が $n$ で割り切れる（$a$ と $b$ を $n$ で割った余りが等しい）。

4.  **[フェルマーの小定理]** $p$ を素数、 $a$ を $p$ と互いに素な整数とするとき、 $a^{p-1} \equiv ? \pmod p$。
    > **Formula**: 1。

5.  **[逆元]** 合同式 $ax \equiv 1 \pmod n$ の解 $x$ （$a$ の逆元 $a^{-1}$）が存在するための条件は何か。
    > **Condition**: $\gcd(a, n) = 1$。

6.  **[素数判定]** ある数が素数かどうかを確率的に判定するアルゴリズム（ミラー・ラビンなど）は、何の定理を応用しているか。
    > **Math**: フェルマーの小定理（の拡張）。

7.  **[公開鍵暗号]** 暗号化鍵と復号鍵が異なる暗号方式を何というか。
    > **Term**: 公開鍵暗号 (Public-key cryptography) / 非対称暗号。

8.  **[一方向性関数]** 計算するのは簡単だが、逆算するのは非常に困難な関数を何というか。
    > **Term**: 一方向性関数 (One-way function)。例：素因数分解。

9.  **[ハッシュ関数]** 任意の長さのデータから固定長の値を生成する関数で、衝突（同じ値になること）を見つけるのが困難なものを何というか。
    > **Term**: 暗号学的ハッシュ関数。

10. **[プログラミング]** `pow(a, b) % n` を計算する際、 `pow(a, b)` を先に計算するとどうなるか。
    > **Tech**: オーバーフローする。 `mod_pow` （逐次剰余）を使うべき。

---

## Phase 2: Applied Mastery (実践暗号理論 10問)

**指針**: RSA暗号の計算手順をトレースし、誤り訂正符号（CRCなど）の仕組みを多項式の割り算として理解する。

11. **[拡張ユークリッド互除法]**
    $17x + 11y = 1$ の整数解 $(x, y)$ を1組求めよ。
    > **Algorithm**: $17 = 1 \cdot 11 + 6, 11 = 1 \cdot 6 + 5, 6 = 1 \cdot 5 + 1$。
    > 逆算: $1 = 6 - 5 = 6 - (11 - 6) = 2 \cdot 6 - 11 = 2(17 - 11) - 11 = 2 \cdot 17 - 3 \cdot 11$。
    > $x=2, y=-3$。

12. **[逆元の計算]**
    $3x \equiv 1 \pmod{11}$ を満たす $x$ を求めよ。
    > **Calculation**: $3 \times 4 = 12 \equiv 1$。 $x=4$。

13. **[RSA暗号の鍵生成]**
    $p=3, q=11$ とする。 $n = pq = 33$。 $\phi(n) = (p-1)(q-1) = 2 \times 10 = 20$。
    公開鍵 $e=3$ とするとき、秘密鍵 $d$ （$ed \equiv 1 \pmod{20}$）を求めよ。
    > **Calculation**: $3d = 1 + 20k$。 $k=1 \to 21$。 $3d=21 \to d=7$。

14. **[RSA暗号化]**
    前問の設定（$n=33, e=3$）で、平文 $M=5$ を暗号化せよ。
    > **Calculation**: $C = M^e \pmod n = 5^3 \pmod{33} = 125 \pmod{33}$。
    > $125 = 3 \times 33 + 26$。 $C=26$。

15. **[RSA復号]**
    前問の暗号文 $C=26$ を秘密鍵 $d=7$ で復号せよ。
    > **Calculation**: $M = C^d \pmod n = 26^7 \pmod{33}$。
    > $26 \equiv -7$。 $(-7)^7 = -(7^7)$。
    > $7^2 = 49 \equiv 16$。 $7^3 \equiv 16 \times 7 = 112 \equiv 13$。
    > $7^7 = 7^3 \times 7^3 \times 7 \equiv 13 \times 13 \times 7 = 169 \times 7 \equiv 4 \times 7 = 28$。
    > $-28 \equiv 5 \pmod{33}$。 $M=5$。一致。

16. **[CRCの計算]**
    データ多項式 $D(x) = x^3 + x + 1$、生成多項式 $G(x) = x^2 + 1$ とする（係数は $\mathbb{F}_2$、つまり0か1）。
    $D(x) \cdot x^2$ を $G(x)$ で割った余り $R(x)$ を求めよ。
    > **Calculation**: $(x^5 + x^3 + x^2) \div (x^2+1)$。
    > $x^5 + x^3 = x^3(x^2+1)$。余り $x^2$。
    > $x^2 = 1(x^2+1) + 1$。余り $1$。
    > 答え: $1$。

17. **[パリティチェック]**
    7ビットのデータに1ビットのパリティ（偶数パリティ）を付加する場合、1ビットの誤りは検出できるか。2ビットの誤りはどうか。
    > **Logic**: 1ビットは検出可。2ビットは検出不可（偶偶でパリティが変わらないため）。

18. **[ハミング距離]**
    2つのビット列 `10101` と `10011` のハミング距離はいくつか。
    > **Calculation**: 異なるビット数。2。

19. **[Diffie-Hellman鍵共有]** (概念)
    離散対数問題の困難性を利用して、通信経路上で秘密鍵を共有するプロトコル。 $g^a \pmod p$ と $g^b \pmod p$ から $g^{ab} \pmod p$ を生成する仕組みを簡単に説明せよ。
    > **Logic**: $(g^a)^b = g^{ab} = (g^b)^a$。

20. **[プログラミング: ビット演算]**
    ある整数 $n$ が $2$ のべき乗かどうかを判定する高速なビット演算式 `n & (n-1) == 0` の原理を説明せよ。
    > **Tech**: $2^k$ はビットが1つだけ立っている。 $2^k-1$ はそれより下位が全て1。ANDをとると0になる。

---

## 解答と解説

### Phase 1

1.  **解説参照**
2.  **1**
3.  **$a-b$ が $n$ で割り切れる**
4.  **1**
5.  **$\gcd(a, n) = 1$**
6.  **フェルマーの小定理**
7.  **公開鍵暗号**
8.  **一方向性関数**
9.  **暗号学的ハッシュ関数**
10. **オーバーフロー**

### Phase 2

11. **$x=2, y=-3$**
12. **4**
13. **7**
14. **26**
15. **5**
16. **1**
    *   $\mathbb{F}_2$ なので引き算は足し算（XOR）と同じ。
    *   $x^5 + x^3 + x^2$ を $x^2+1$ で割る。
    *   $x^3(x^2+1) = x^5+x^3$。引くと $x^2$。
    *   $1(x^2+1) = x^2+1$。引くと $1$。
17. **1ビット検出可、2ビット不可**
18. **2**
19. **解説参照**
20. **解説参照**

