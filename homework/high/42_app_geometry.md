# 数学総合応用 (2) 計算幾何学 (Session 42)

**対象**: 社会人エンジニア (Rust/Go)
**学習目標**: ベクトルと図形の方程式を応用し、衝突判定、レイキャスティング、座標変換などの計算幾何学アルゴリズムを実装レベルで理解する。

---

## Phase 1: Foundational Check (理論的背景 10問)

**指針**: 幾何学的問題を代数（ベクトル・行列・不等式）に変換する視点を持つ。

1.  **[ベクトルの内積]** 2つのベクトル $\vec{a}, \vec{b}$ のなす角 $\theta$ が鋭角か鈍角かを判定するには、内積 $\vec{a} \cdot \vec{b}$ の何を確認すればよいか。
    > **Logic**: 符号（正なら鋭角、負なら鈍角）。

2.  **[ベクトルの外積]** 2次元ベクトル $\vec{a}(x_1, y_1), \vec{b}(x_2, y_2)$ のクロス積（行列式） $x_1 y_2 - x_2 y_1$ の幾何学的意味は何か。
    > **Meaning**: 平行四辺形の面積（符号付き）。 $\vec{b}$ が $\vec{a}$ の左側にあるか右側にあるかの判定に使える。

3.  **[点と直線の距離]** 点 $P$ と直線 $L$ の距離が $0$ であるとは、幾何学的にどういう状態か。
    > **State**: 点 $P$ が直線 $L$ 上にある。

4.  **[円の衝突判定]** 2つの円 $C_1(r_1), C_2(r_2)$ が衝突している（接するまたは重なる）ための条件式を、中心間距離 $d$ を用いて記述せよ。
    > **Formula**: $d \le r_1 + r_2$。

5.  **[AABB]** 軸に平行な矩形 (Axis-Aligned Bounding Box) の衝突判定条件を記述せよ。矩形1: $[x_{1min}, x_{1max}] \times [y_{1min}, y_{1max}]$。
    > **Logic**: $x$軸で重なり、かつ $y$軸で重なる。 $(x_{1min} \le x_{2max} \land x_{2min} \le x_{1max}) \land \dots$。

6.  **[重心座標]** 三角形 $ABC$ 内部の点 $P$ を $\vec{P} = u\vec{A} + v\vec{B} + w\vec{C}$ ($u+v+w=1$) と表すとき、 $P$ が三角形の内部にあるための $u, v, w$ の条件は何か。
    > **Condition**: $0 < u < 1, 0 < v < 1, 0 < w < 1$。

7.  **[正規化]** ベクトル $\vec{v}$ を長さ1の単位ベクトル $\hat{n}$ に変換する式を記述せよ。
    > **Formula**: $\vec{v} / |\vec{v}|$。

8.  **[射影]** ベクトル $\vec{a}$ の、単位ベクトル $\hat{n}$ 方向への正射影ベクトルの長さはいくらか。
    > **Formula**: $\vec{a} \cdot \hat{n}$。

9.  **[平面の方程式]** 3次元空間において、法線ベクトル $\vec{n}(a, b, c)$ と通る点 $P_0(x_0, y_0, z_0)$ で定義される平面の方程式を記述せよ。
    > **Formula**: $a(x-x_0) + b(y-y_0) + c(z-z_0) = 0$。

10. **[プログラミング]** 浮動小数点数の比較において、 `a == b` と書くのが危険な理由と、正しい比較方法を述べよ。
    > **Tech**: 丸め誤差のため。 `abs(a - b) < EPSILON`。

---

## Phase 2: Applied Mastery (実践アルゴリズム 10問)

**指針**: 図形の問題を「不等式の充足問題」や「ベクトルの演算」に帰着させる。

11. **[レイと球の交差]**
    始点 $S$、方向 $\vec{d}$ （単位ベクトル）のレイ $\vec{r}(t) = S + t\vec{d}$ ($t \ge 0$) と、中心 $C$、半径 $R$ の球が交差するかどうかを判定する2次方程式を導出せよ。
    > **Derivation**: $|\vec{r}(t) - C|^2 = R^2$ に代入。

12. **[点と三角形の包含判定]**
    点 $P$ が $\triangle ABC$ の内部にあるかどうかを、外積（クロス積）を用いて判定するアルゴリズムを記述せよ（2次元）。
    > **Algorithm**: $\vec{AB} \times \vec{AP}, \vec{BC} \times \vec{BP}, \vec{CA} \times \vec{CP}$ の符号がすべて同じなら内部。

13. **[線分と線分の交差]**
    2つの線分 $AB$ と $CD$ が交差しているかどうかを判定する方法を、外積を用いて説明せよ。
    > **Algorithm**: 直線 $AB$ に対して $C, D$ が反対側にあり、かつ直線 $CD$ に対して $A, B$ が反対側にある。

14. **[ポリゴンの面積]**
    頂点が順に $(x_1, y_1), \dots, (x_n, y_n)$ で与えられる多角形の面積を求める公式（靴紐の公式）を記述せよ。
    > **Formula**: $\frac{1}{2} | \sum (x_i y_{i+1} - x_{i+1} y_i) |$。

15. **[凸包]** (発展)
    点群から凸包 (Convex Hull) を構成するアルゴリズム（グラハムスキャンなど）において、点が「左折」するか「右折」するかの判定には何を使うか。
    > **Math**: 外積の符号。

16. **[最近傍点探索]**
    点 $P$ から線分 $AB$ への最短距離を求める際、垂線の足が線分上にある場合とない場合（端点が最短）をどう区別するか。内積を用いて説明せよ。
    > **Logic**: $\vec{AB} \cdot \vec{AP}$ が負なら $A$ 側、 $\vec{AB} \cdot \vec{AP} > |\vec{AB}|^2$ なら $B$ 側。

17. **[円の反射]**
    速度 $\vec{v}$ で動く円が、法線 $\vec{n}$ の壁に衝突した。反射後の速度 $\vec{v'}$ を求めよ（完全弾性衝突）。
    > **Formula**: $\vec{v'} = \vec{v} - 2(\vec{v} \cdot \vec{n})\vec{n}$。

18. **[視錐台カリング]** (発展)
    3Dグラフィックスにおいて、オブジェクトがカメラの視野内（視錐台）にあるかどうかを判定するには、どのような数学的処理を行うか。
    > **Math**: 6つの平面（左右上下前後）の方程式に対し、オブジェクト（球やAABB）が「内側」にあるか判定する。

19. **[ボロノイ図]**
    2点 $A, B$ のボロノイ境界線の方程式は何か。
    > **Math**: 線分 $AB$ の垂直二等分線。

20. **[プログラミング: 構造体]**
    2次元ベクトルを表す構造体 `Vec2` に、メソッド `dot(other)`, `cross(other)`, `len()`, `norm()` を実装する際のシグネチャ（Rust/Go風）を記述せよ。

---

## 解答と解説

### Phase 1

1.  **符号（正:鋭角, 0:直角, 負:鈍角）**
2.  **平行四辺形の面積（向き付き）**
3.  **点 $P$ が直線 $L$ 上にある**
4.  **$d \le r_1 + r_2$**
5.  **各軸で区間が重なる**
6.  **$0 < u, v, w < 1$**
7.  **$\vec{v} / |\vec{v}|$**
8.  **$\vec{a} \cdot \hat{n}$**
9.  **$a(x-x_0) + b(y-y_0) + c(z-z_0) = 0$**
10. **丸め誤差**

### Phase 2

11. **$|\vec{S} + t\vec{d} - \vec{C}|^2 = R^2$**
    *   $|\vec{X}|^2 = \vec{X} \cdot \vec{X}$ を利用して展開。
    *   $t^2 + 2t \vec{d} \cdot (\vec{S}-\vec{C}) + |\vec{S}-\vec{C}|^2 - R^2 = 0$。
12. **外積の符号が全て同じ**
    *   反時計回りなら全て正。
13. **解説参照**
    *   $CCW(A, B, C) \times CCW(A, B, D) < 0$ かつ ...
14. **靴紐の公式 (Shoelace Formula)**
15. **外積の符号**
16. **解説参照**
    *   $t = (\vec{AP} \cdot \vec{AB}) / |\vec{AB}|^2$。
    *   $t < 0$ なら $A$、 $t > 1$ なら $B$、 $0 \le t \le 1$ なら垂線の足。
17. **$\vec{v} - 2(\vec{v} \cdot \vec{n})\vec{n}$**
18. **平面との距離判定**
19. **垂直二等分線**
20. **解説**
    *   `fn dot(&self, other: &Vec2) -> f64`
    *   `func (v Vec2) Cross(other Vec2) float64`

