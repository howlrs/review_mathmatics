# 数学総合応用 (3) 最適化とアルゴリズム (Session 43)

**対象**: 社会人エンジニア (Rust/Go)
**学習目標**: 関数の最大・最小問題、線形計画法、勾配降下法の基礎となる数学的概念を理解し、最適化問題へのアプローチ方法を習得する。

---

## Phase 1: Foundational Check (理論的背景 10問)

**指針**: 「最適化」とは、制約条件の下で目的関数を最大化・最小化することである。

1.  **[2次関数の最小化]** 関数 $f(x) = ax^2 + bx + c$ ($a > 0$) が最小値をとる $x$ の値はいくつか。
    > **Formula**: $x = -b / 2a$。

2.  **[微分と極値]** 微分可能な関数 $f(x)$ が $x=a$ で極値をとるための必要条件は何か（数II範囲外だが知識として）。
    > **Condition**: $f'(a) = 0$。

3.  **[領域の最大値]** 領域 $D$ で定義された関数 $f(x, y) = ax + by$ の最大値は、通常どこでとるか（領域が凸多角形の場合）。
    > **Location**: 頂点（または辺上）。

4.  **[距離の最小化]** 点 $P(x, y)$ と原点の距離 $\sqrt{x^2+y^2}$ を最小化することは、何を最小化することと同値か。
    > **Logic**: $x^2 + y^2$ （平方根は単調増加関数なので）。

5.  **[相加相乗平均]** $x > 0$ において $x + \frac{1}{x}$ の最小値はいくつか。
    > **Value**: 2。

6.  **[制約条件]** $g(x, y) = 0$ という条件下で $f(x, y)$ を最大化する問題を何というか。
    > **Term**: 制約付き最適化問題。

7.  **[凸関数]** 下に凸な関数 $f(x)$ の任意の2点間の弦は、グラフのどちら側にあるか。
    > **Position**: 上側。

8.  **[勾配の向き]** 関数 $f(x, y)$ の勾配ベクトル $\nabla f$ は、関数の値がどうなる方向を向いているか。
    > **Direction**: 最も急激に増加する方向。

9.  **[局所解と大域解]** 勾配法などで求まる「極小値」は、必ずしも「最小値」とは限らない。これを何というか。
    > **Term**: 局所解 (Local Minimum)。

10. **[プログラミング]** 浮動小数点数で最小値を探索する際、 `min_val = 0` で初期化することの問題点は何か。
    > **Tech**: 答えが負の場合や、0より大きい場合に更新されない。 `Infinity` または最初のデータ点で初期化すべき。

---

## Phase 2: Applied Mastery (実践最適化 10問)

**指針**: 現実の問題を数式（目的関数と制約条件）に落とし込むモデリング能力を養う。

11. **[線形計画法]**
    製品A（利益3, 原料2）と製品B（利益4, 原料3）を作る。原料の上限は12。利益 $3x + 4y$ を最大化する非負整数 $x, y$ を求めよ。
    > **Algorithm**: $2x + 3y \le 12$。 $(0, 4) \to 16, (6, 0) \to 18, (3, 2) \to 17$。
    > 頂点付近の整数点を調べる。

12. **[最小二乗法の原理]**
    データ点 $(1, 2), (2, 3), (3, 5)$ に最もフィットする直線 $y = ax$ （原点を通る）を求めたい。最小化すべき誤差関数 $E(a)$ を定義せよ。
    > **Formula**: $E(a) = (a-2)^2 + (2a-3)^2 + (3a-5)^2$。

13. **[最小二乗法の解]**
    前問の $E(a)$ を最小にする $a$ を求めよ。
    > **Calculation**: $E(a) = 14a^2 - 46a + 38$。 $a = 46/28 = 23/14$。

14. **[在庫管理]** (EOQモデル簡易版)
    1回の発注コストが $C$、1個あたりの在庫保管コストが $H$、年間需要が $D$ のとき、総コスト $TC(Q) = \frac{D}{Q}C + \frac{Q}{2}H$ を最小にする発注量 $Q$ を求めよ（相加相乗平均を利用）。
    > **Formula**: $\sqrt{2DC/H}$。

15. **[経路探索]**
    グリッド上のA地点からB地点へ移動するコストが、平地は1、森は5とする。コスト最小の経路を求めるアルゴリズムは何か。
    > **Algorithm**: ダイクストラ法 (Dijkstra) または A* (A-Star)。

16. **[勾配降下法]**
    $f(x) = x^2 - 4x + 4$ の最小値を求めるために、初期値 $x_0 = 0$、学習率 $\eta = 0.1$ で勾配降下法を1ステップ行った後の $x_1$ を求めよ。
    > **Calculation**: $f'(x) = 2x - 4$。 $f'(0) = -4$。
    > $x_1 = x_0 - \eta f'(0) = 0 - 0.1(-4) = 0.4$。

17. **[ラグランジュの未定乗数法]** (概念のみ)
    $x^2 + y^2 = 1$ の下で $x+y$ を最大化する際、等高線 $x+y=k$ と円はどういう関係になるか。
    > **Relation**: 接する（法線ベクトルが平行になる）。

18. **[ナップサック問題]**
    重さと価値が異なる品物を容量 $W$ のナップサックに詰め込む問題は、線形計画法で解けるか、それとも別の手法が必要か。
    > **Theory**: 整数計画問題（NP困難）なので、動的計画法 (DP) などが必要。単純な線形計画法（シンプレックス法）では解けない。

19. **[二分探索]**
    単調増加関数 $f(x)$ について $f(x) = 0$ となる $x$ を求めるアルゴリズムの計算量はオーダーいくつか。
    > **Complexity**: $O(\log N)$。

20. **[プログラミング: 焼きなまし法]**
    局所解に陥らないために、確率的に悪い解への移動も許容し、徐々にその確率を下げていく最適化手法を何というか。
    > **Term**: 焼きなまし法 (Simulated Annealing)。

---

## 解答と解説

### Phase 1

1.  **$-b/2a$**
2.  **$f'(a) = 0$**
3.  **頂点**
4.  **$x^2 + y^2$**
5.  **2**
6.  **制約付き最適化問題**
7.  **上側**
8.  **増加方向**
9.  **局所解 (Local Minimum)**
10. **初期化の問題**

### Phase 2

11. **$x=6, y=0$ (利益18)**
    *   $2x+3y \le 12$。
    *   $(0, 4) \to 16$。
    *   $(3, 2) \to 9+8=17$。
    *   $(6, 0) \to 18$。
12. **$\sum (y_i - ax_i)^2$**
13. **$23/14$**
    *   $E(a) = (a^2-4a+4) + (4a^2-12a+9) + (9a^2-30a+25) = 14a^2 - 46a + 38$。
    *   $a = 46/28 = 23/14$。
14. **$\sqrt{2DC/H}$**
    *   積が一定 $(D/Q)C \times (Q/2)H = DCH/2$。
    *   最小値は $2\sqrt{DCH/2}$。そのときの $Q$ は等号成立条件。
    *   $(DC)/Q = (QH)/2 \Rightarrow Q^2 = 2DC/H$。
15. **ダイクストラ法 / A\***
16. **0.4**
17. **接する**
18. **動的計画法 (DP)**
19. **$O(\log N)$**
20. **焼きなまし法 (Simulated Annealing)**

