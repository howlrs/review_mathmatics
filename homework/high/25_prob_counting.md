# 数学A: 場合の数 (1) 数え上げの原則 (Session 25)

**対象**: 社会人エンジニア (Rust/Go)
**学習目標**: 和の法則（OR）と積の法則（AND）を理解し、漏れなく重複なく数え上げるアルゴリズム的思考を養う。計算量見積もりの基礎となる。

---

## Phase 1: Foundational Check (基礎確認 10問)

**指針**: 「困ったときは『定義』に還れ」。事象が「同時に起こるか（積）」、「同時には起こらないか（和）」を見極めよ。

1.  **[和の法則]** サイコロを1回振るとき、偶数の目が出るか、または5以上の目が出る場合の数を求めよ。
    > **Logic**: 集合 $A=\{2, 4, 6\}, B=\{5, 6\}$。 $A \cup B$ の要素数。 $n(A)+n(B)-n(A \cap B)$。

2.  **[積の法則]** 大中小3つのサイコロを同時に振るとき、目の出方は全部で何通りか。
    > **Prog Link**: ネストしたループ。 `6 * 6 * 6`。 $O(N^3)$。

3.  **[積の法則]** A町からB町へ行く道が3本、B町からC町へ行く道が4本ある。A町からB町を通ってC町へ行く行き方は何通りか。

4.  **[約数の個数]** $72$ の正の約数の個数を求めよ。
    > **Algorithm**: 素因数分解 $72 = 2^3 \cdot 3^2$。 $(3+1)(2+1)$。

5.  **[樹形図]** コインを3回投げるとき、表と裏の出方は全部で何通りか。樹形図をイメージして答えよ。
    > **Prog Link**: 再帰呼び出しのトレース。深さ3の二分木。

6.  **[展開式の項数]** 式 $(a+b)(x+y+z)$ を展開したとき、項は何個できるか。

7.  **[和の法則]** 1から10までの自然数のうち、2の倍数または3の倍数は何個あるか。
    > **Prog Link**: FizzBuzz問題の条件判定。 `if i % 2 == 0 || i % 3 == 0`。

8.  **[補集合]** 大中小3つのサイコロを投げるとき、少なくとも1つは1の目が出る場合の数を求めよ。
    > **Maxim**: 「『少なくとも』は『余事象』を疑え」。全体 - (全部1以外)。

9.  **[順列の基礎]** 異なる5冊の本から3冊選んで並べる方法は何通りか（記号 $P$ を使わずに計算せよ）。
    > **Logic**: 1冊目は5通り、2冊目は4通り、3冊目は3通り。

10. **[組合せの基礎]** 異なる5冊の本から3冊選ぶ方法は何通りか（記号 $C$ を使わずに計算せよ）。
    > **Logic**: 並べる場合の数 $\div$ 重複度 ($3!$)。

---

## Phase 2: Applied Mastery (応用・実践 10問)

**指針**: 「『解き方』は一つにあらず」。場合分け（Case Analysis）を行い、それぞれのケースで積の法則を適用し、最後に和の法則でまとめる（Divide and Conquer）。

11. **[支払いの組み合わせ]**
    100円硬貨が4枚、50円硬貨が1枚、10円硬貨が3枚ある。これらを使って支払える金額（0円を除く）は何通りあるか。
    > **Algorithm**: 各硬貨の枚数+1の積から、0円の場合（1通り）を引く。ただし、硬貨の組み合わせで同じ金額が作れる場合（例: 50円2枚と100円1枚）は注意が必要だが、今回は50円が1枚なので重複はない。

12. **[支払いの組み合わせ（重複あり）]**
    100円硬貨が3枚、50円硬貨が3枚、10円硬貨が2枚ある。これらを使って支払える金額（0円を除く）は何通りあるか。
    > **Tip**: 50円2枚で100円が作れるため、単純な積では重複する。大きい硬貨を小さい硬貨に換算して考える（100円3枚を50円6枚とみなす）。

13. **[塗り分け]**
    右の図のような4つの領域 A, B, C, D を、赤・青・黄・緑の4色を使って塗り分ける。隣り合う領域は異なる色にしたい。
    (1) 4色すべてを使う場合
    (2) 3色だけ使う場合
    それぞれの塗り方は何通りか。
    > **Prog Link**: グラフ彩色問題 (Graph Coloring)。

14. **[経路の数]**
    図のような格子状の道がある。A地点からB地点まで、最短距離で行く道順は何通りか。途中でC地点を通るものとする。
    > **Algorithm**: A$\to$C の数 $\times$ C$\to$B の数。

15. **[約数の総和]**
    $360$ の正の約数の総和を求めよ。
    > **Formula**: $(1+2+2^2+2^3)(1+3+3^2)(1+5)$。分配法則の逆。

16. **[条件付きの数え上げ]**
    男子3人、女子3人が一列に並ぶとき、男女が交互に並ぶ並び方は何通りか。
    > **Logic**: (男女男女男女) または (女男女男女男)。 $2 \times (3! \times 3!)$。

17. **[数字の個数]**
    0, 1, 2, 3, 4 の5個の数字から異なる3個を選んで3桁の整数を作るとき、偶数は何個できるか。
    > **Maxim**: 「条件の強い場所（一の位）から決めよ」。一の位が 0 の場合と、2, 4 の場合で、百の位の選び方が変わる（0の処理）。

18. **[辞書式配列]**
    a, b, c, d, e の5文字を全部使ってできる順列を、辞書式に並べるとき、 50番目の文字列を求めよ。
    > **Algorithm**: 先頭が a のものは $4! = 24$ 個。 b のものも 24 個。次から探す。

19. **[完全順列]**
    1から4までの番号が書かれた箱に、1から4までの番号が書かれた玉を1つずつ入れる。どの箱にも、箱の番号と同じ番号の玉が入らない入れ方（完全順列/攪乱順列）は何通りか。
    > **Prog Link**: モンモール数。再帰式 $D_n = (n-1)(D_{n-1} + D_{n-2})$。

20. **[部分集合の個数]**
    集合 $A = \{1, 2, \dots, n\}$ の部分集合のうち、要素数が偶数であるものの個数を求めよ。
    > **Tip**: 二項定理 $(1-1)^n$ を利用するか、ある要素を含む/含まないで一対一対応を作る。答えは $2^{n-1}$。

---

## 解答と解説

### Phase 1

1.  **4通り**
    *   $A=\{2, 4, 6\}, B=\{5, 6\}$。 $A \cup B = \{2, 4, 5, 6\}$。
2.  **216通り**
    *   $6 \times 6 \times 6 = 216$。
3.  **12通り**
    *   $3 \times 4 = 12$。
4.  **12個**
    *   $72 = 2^3 \cdot 3^2$。 $(3+1)(2+1) = 12$。
5.  **8通り**
    *   $2^3 = 8$。
6.  **6個**
    *   $2 \times 3 = 6$。
7.  **7個**
    *   $n(2) = 5, n(3) = 3, n(6) = 1$。
    *   $5 + 3 - 1 = 7$。
8.  **91通り**
    *   全体 $6^3 = 216$。
    *   全部1以外 $5^3 = 125$。
    *   $216 - 125 = 91$。
9.  **60通り**
    *   $5 \times 4 \times 3 = 60$。
10. **10通り**
    *   $60 / (3 \times 2 \times 1) = 10$。

### Phase 2

11. **19通り**
    *   $(4+1)(1+1)(3+1) - 1 = 5 \cdot 2 \cdot 4 - 1 = 39$ ... ではない。
    *   50円1枚と10円3枚では重複しない。
    *   100円4枚と50円1枚... 50円2枚がないので、100円を作る方法は100円玉のみ。
    *   よって重複はない。答えは 39通り。
12. **35通り**
    *   50円3枚 $\to$ 50円2枚で100円と被る。
    *   100円3枚を50円6枚とみなす。
    *   50円玉が $6+3=9$枚、10円玉が2枚。
    *   $(9+1)(2+1) - 1 = 29$通り... ではない。
    *   100円3枚、50円3枚、10円2枚。
    *   作れる金額は 10円単位。
    *   最小10円、最大 $300+150+20 = 470$円。
    *   10円玉が2枚しかないので、10円単位の端数は 0, 10, 20 のみ。30円や40円は作れない。
    *   50円単位の部分（$X$）と10円単位の部分（$Y$）に分ける。
    *   $Y \in \{0, 10, 20\}$ (3通り)。
    *   $X$ は 100円3枚、50円3枚で作れる50円単位の金額。
    *   100円3枚 $\to$ 50円6枚分。計 50円9枚分相当。
    *   $0, 50, 100, \dots, 450$円まで、50円刻みですべて作れるか？
    *   50円3枚あるので、50円単位の端数はカバーできる。
    *   よって $0$ から $450$ まで50円刻みで10通り。
    *   $10 \times 3 - 1 = 29$通り。
    *   (解説修正: **29通り**)
13. **(1) 24通り, (2) 36通り** ... 図の形状による。
    *   Aを中心にB, C, Dが囲む形と仮定（あるいは一列 A-B-C-D）。
    *   一般的な「田」の字型（AとD、BとCが対角）とする。
    *   (1) $4! = 24$通り。
    *   (2) AとDが同色、またはBとCが同色。
    *   Aを塗る(4) $\to$ B(3) $\to$ C(2) $\to$ D(Aと同じなら1, Cと同じなら...隣り合うので不可)。
    *   A(4), B(3), C(3), D(3) ... 制約が複雑。
    *   A(4) $\to$ B(3) $\to$ C(2) $\to$ D(2) (A, Cと異なる)。計 $4 \times 3 \times 2 \times 2 = 48$通り？
    *   このうち4色使うのは $4 \times 3 \times 2 \times 1 = 24$通り。
    *   3色使うのは $48 - 24 = 24$通り？
    *   問題文の図が不明確なので、一般的な「一列 (A-B-C-D)」と仮定する。
    *   (1) $4 \times 3 \times 2 \times 1 = 24$。
    *   (2) A(4), B(3), C(2), D(AかBと同じ)。
        *   A-B-A-B (2色)
        *   A-B-A-C (3色)
        *   A-B-C-A (3色)
        *   A-B-C-B (3色)
    *   3色の場合:
        *   AとCが同色: $4 \times 3 \times 1 \times 2 = 24$。
        *   BとDが同色: $4 \times 3 \times 2 \times 1 = 24$。
        *   重複（A=C かつ B=D）: $4 \times 3 \times 1 \times 1 = 12$ (2色)。
        *   和集合: $24 + 24 - 12 = 36$？ いや、これは「3色以下」。
        *   正確に:
            *   パターン1 (A=C, B!=D): $4 \times 3 \times 1 \times 2 = 24$ (3色)。
            *   パターン2 (A!=C, B=D): $4 \times 3 \times 2 \times 1 = 24$ (3色)。
            *   パターン3 (A!=C, B!=D, A!=D...): 4色。
        *   一列の場合、3色で塗る方法は...
        *   $4 \times 3 \times 2 \times 2 = 48$ (全塗り方)。
        *   4色は24通り。
        *   2色は $4 \times 3 \times 1 \times 1 = 12$通り。
        *   3色は $48 - 24 - 12 = 12$通り。
    *   (図がないと確定しないため、この問題は「田」の字型とし、解答は保留または柔軟に記述)
    *   **修正**: 問題文に「隣り合う領域」の接続関係を明記すべき。
    *   ここでは「AはB, C, Dと隣り合う（中心A）」とする。
    *   (1) A(4), B(3), C(2), D(1) $\to 24$。
    *   (2) A(4), B(3), C(2), D(Bと同じ) $\to 24$。
    *   答え: 24, 24。
14. **積の法則**
    *   A-C: $m$ 通り, C-B: $n$ 通り $\to mn$ 通り。
15. **1170**
    *   $360 = 2^3 \cdot 3^2 \cdot 5$。
    *   $(15)(13)(6) = 1170$。
16. **72通り**
    *   男女交互: (男3!)(女3!) $\times 2$ (先頭が男か女か)。
    *   $6 \times 6 \times 2 = 72$。
17. **36個**
    *   一の位が0: 残り4個から2個並べる $\to 4 \times 3 = 12$。
    *   一の位が2, 4 (2通り): 百の位は0以外(3通り)、十の位は残り(3通り) $\to 2 \times 3 \times 3 = 18$。
    *   合計 $12 + 18 = 30$個。
    *   (計算ミス確認: $2 \times 3 \times 3 = 18$。 $12+18=30$。
    *   答え: 30個。
    *   解説修正: **30個**)
18. **cbaed**
    *   a...: 24個。
    *   b...: 24個。ここまで48個。
    *   50番目は c... の2番目。
    *   49: cabde (辞書順最小は abde)
    *   50: cabed
    *   (順列: a, b, d, e。最小 abde, 次 abed。
    *   c の次は a。 ca... 残り b, d, e。
    *   cabde (49), cabed (50)。
    *   答え: cabed。
    *   解説修正: **cabed**)
19. **9通り**
    *   $D_4 = 9$。 (0, 1, 2, 9, 44...)
20. **$2^{n-1}$**
    *   $(1+x)^n$ の展開式で $x=-1$ を代入。
    *   $_nC_0 - _nC_1 + \dots = 0$。
    *   偶数個の和 = 奇数個の和。
    *   合計 $2^n$ なので、半分ずつで $2^{n-1}$。

