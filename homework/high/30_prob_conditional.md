# 数学A: 確率 (3) 条件付き確率 (Session 30)

**対象**: 社会人エンジニア (Rust/Go)
**学習目標**: 条件付き確率 $P_A(B)$ の定義を理解し、乗法定理やベイズの定理を用いて、情報が得られた後の確率更新（事後確率）を計算できるようにする。

---

## Phase 1: Foundational Check (基礎確認 10問)

**指針**: 「困ったときは『定義』に還れ」。 $P_A(B) = P(A \cap B) / P(A)$。全体集合が $U$ から $A$ に縮小するイメージを持て。

1.  **[条件付き確率の定義]** 事象Aが起こったときに事象Bが起こる確率 $P_A(B)$ の定義式を記述せよ。
    > **Prog Link**: フィルタリング後のデータセットにおける割合。

2.  **[計算]** 赤玉3個、白玉2個が入った袋から、A君が1個取り出し、戻さずにB君が1個取り出す。A君が赤玉を取り出したとき、B君が赤玉を取り出す確率を求めよ。
    > **Logic**: 袋の中身は赤2、白2になっている。

3.  **[乗法定理]** $P(A \cap B) = P(A) \times P_A(B)$ を用いて、前問で「A君もB君も赤玉を取り出す確率」を求めよ。

4.  **[独立事象]** 事象AとBが独立であるとき、 $P_A(B)$ は何に等しいか。
    > **Logic**: Aが起こってもBの確率は変わらない。 $P(B)$。

5.  **[表]** あるクラスの男女比と眼鏡使用率は以下の通りである。
    |      | 眼鏡あり | 眼鏡なし |
    | :--- | :------- | :------- |
    | 男子 | 10人     | 15人     |
    | 女子 | 5人      | 20人     |
    このクラスから1人選んだとき、その人が「眼鏡あり」であった。その人が男子である確率を求めよ。
    > **Calculation**: $10 / (10+5)$。

6.  **[原因の確率]** (ベイズの定理の導入)
    工場Aの製品には2%の不良品、工場Bの製品には3%の不良品が含まれる。製品が不良品であったとき、それが工場Aで作られたものである確率を求めるには、何の情報が追加で必要か。
    > **Answer**: 工場Aと工場Bの生産量の比率（事前確率）。

7.  **[陽性適中率]** 検査の精度が100%でない場合、検査結果が陽性でも病気でない可能性がある。これを何というか。
    > **Term**: 偽陽性 (False Positive)。

8.  **[全確率の公式]** $P(B) = P(A \cap B) + P(\bar{A} \cap B)$ を $P_A(B)$ などを用いて書き換えよ。

9.  **[3つの事象]** $P(A \cap B \cap C)$ を乗法定理で展開せよ。
    > **Formula**: $P(A) P_A(B) P_{A \cap B}(C)$。連鎖律 (Chain Rule)。

10. **[プログラミング]** スパムフィルタにおいて、「"無料"という単語が含まれるメールがスパムである確率」を計算する手法を何というか。
    > **Term**: ナイーブベイズ分類器 (Naive Bayes Classifier)。

---

## Phase 2: Applied Mastery (応用・実践 10問)

**指針**: 「条件を使い切ったか確認せよ」。時系列を逆転させる（結果から原因を推測する）問題では、ベイズの定理が強力な武器になる。

11. **[くじ引きの公平性]**
    当たり3本を含む10本のくじを、A, Bの順に引く（戻さない）。
    Bが当たったとき、Aも当たっていた確率を求めよ。
    > **Algorithm**: $P(A \cap B) / P(B)$。
    > $P(B) = 3/10$。 $P(A \cap B) = (3/10)(2/9) = 6/90$。
    > $(6/90) / (27/90) = 6/27 = 2/9$。

12. **[検査の確率]**
    ある病気の罹患率は $0.1\%$ である。
    検査の感度（病気の人を陽性と判定する確率）は $99\%$、特異度（病気でない人を陰性と判定する確率）は $99\%$ である。
    検査で陽性が出たとき、本当に病気である確率を求めよ。
    > **Calculation**: $P(\text{病}) = 0.001, P(\text{健}) = 0.999$。
    > $P(\text{陽}|\text{病}) = 0.99, P(\text{陽}|\text{健}) = 0.01$。
    > $P(\text{陽}) = 0.001 \times 0.99 + 0.999 \times 0.01$。
    > $P(\text{病}|\text{陽}) = (0.001 \times 0.99) / P(\text{陽})$。

13. **[モンティ・ホール問題]**
    3つのドアのうち1つに賞品がある。あなたがドアAを選んだ後、司会者がハズレのドアBを開けた。
    あなたはドアAのままにすべきか、ドアCに変えるべきか。確率を用いて説明せよ。
    > **Logic**: ドアを変えると当たる確率は $2/3$ になる。

14. **[情報通信]**
    0を送ったとき0と受信される確率は0.9、1と誤る確率は0.1。
    1を送ったとき1と受信される確率は0.8、0と誤る確率は0.2。
    送信側で0と1を等確率(0.5)で送るとき、受信側で0を受け取った場合に、送信側が0を送っていた確率を求めよ。

15. **[袋の選択]**
    袋Aには赤3白2、袋Bには赤2白4が入っている。
    サイコロを投げて1, 2なら袋A、3〜6なら袋Bを選び、そこから玉を1個取り出す。
    取り出した玉が赤であったとき、それが袋Aから取り出された確率を求めよ。

16. **[3囚人問題]** (発展)
    A, B, Cの3人のうち2人が処刑され、1人が恩赦になる。Aが看守に「B, Cのうち処刑される1人の名前を教えてくれ」と頼む。看守が「Bだ」と答えたとき、Aが助かる確率は変化するか。
    > **Logic**: 変化しない（1/3のまま）。モンティ・ホール問題との違いに注意。

17. **[原因の推定]**
    ある機械が故障する原因として、部品Xの故障(A)と部品Yの故障(B)が考えられる。
    過去のデータでは $P(A)=0.2, P(B)=0.3$ である（同時故障もありうる）。
    今、機械が故障した。このとき、部品Xが故障している確率 $P_{\text{故障}}(A)$ を求めよ。ただし、XかYの少なくとも一方が故障すれば機械は故障するとする ($A \cup B = \text{故障}$)。

18. **[偽陽性のパラドックス]**
    なぜ「罹患率が低い病気」の検査では、陽性適中率が極端に低くなるのか。数式を使わずに直感的に説明せよ。
    > **Explanation**: 本当に病気の人（真陽性）の絶対数が、健康なのに間違って陽性になった人（偽陽性）の絶対数よりも遥かに少ないから。

19. **[ベイズ更新]**
    あるコインが「表が出る確率 $p=0.5$ の普通のコイン」か「表が出る確率 $p=0.8$ のイカサマコイン」か不明である（事前確率は五分五分）。
    コインを1回投げて表が出た。このコインがイカサマコインである確率はどう変化するか。

20. **[プログラミング: ベイズフィルタ]**
    スパムメール分類器を実装する際、未知の単語（学習データに含まれない単語）が出現した場合、確率が0になってしまう問題（ゼロ頻度問題）をどう解決するか。
    > **Tech**: ラプラススムージング (Laplace Smoothing)。全ての単語の出現回数に $+1$ する。

---

## 解答と解説

### Phase 1

1.  **$P(A \cap B) / P(A)$**
2.  **2/4 = 1/2**
3.  **3/10**
    *   $(3/5) \times (2/4) = 6/20 = 3/10$。
4.  **$P(B)$**
5.  **2/3**
    *   眼鏡あり全体: $10+5=15$人。
    *   そのうち男子: 10人。
    *   $10/15 = 2/3$。
6.  **生産量の比率（事前確率）**
7.  **偽陽性 (False Positive)**
8.  **$P(A)P_A(B) + P(\bar{A})P_{\bar{A}}(B)$**
9.  **$P(A) P(B|A) P(C|A \cap B)$**
10. **ナイーブベイズ分類器**

### Phase 2

11. **2/9**
    *   $P(B) = 3/10$。
    *   $P(A \cap B) = (3/10)(2/9) = 6/90$。
    *   $(6/90) / (3/10) = 6/27 = 2/9$。
12. **約 9%**
    *   $P(\text{陽}) = 0.001 \times 0.99 + 0.999 \times 0.01 = 0.00099 + 0.00999 = 0.01098$。
    *   $P(\text{病}|\text{陽}) = 0.00099 / 0.01098 \approx 0.0901$。
13. **変えるべき (2/3)**
    *   Aが当たりの確率 1/3。B, Cが当たりの確率 2/3。
    *   Bがハズレとわかった $\to$ Cが当たりの確率が 2/3 に凝縮される。
14. **9/13**
    *   $P(0\text{受}) = 0.5 \times 0.9 + 0.5 \times 0.2 = 0.45 + 0.1 = 0.55$。
    *   $P(0\text{送} \cap 0\text{受}) = 0.5 \times 0.9 = 0.45$。
    *   $0.45 / 0.55 = 45/55 = 9/11$ ... 訂正。
    *   計算: $0.45 / 0.55 = 9/11$。
    *   (問題文の $0.2$ は「1を送って0と誤る」確率。正しい。
    *   答え: 9/11。
    *   解説修正: **9/11**)
15. **9/19**
    *   $P(A) = 1/3, P(B) = 2/3$。
    *   $P(\text{赤}|A) = 3/5, P(\text{赤}|B) = 2/6 = 1/3$。
    *   $P(\text{赤}) = (1/3)(3/5) + (2/3)(1/3) = 1/5 + 2/9 = 19/45$。
    *   $P(A \cap \text{赤}) = 1/5 = 9/45$。
    *   $(9/45) / (19/45) = 9/19$。
16. **変化しない (1/3)**
    *   Aが助かる事象 $S_A$。 $P(S_A)=1/3$。
    *   看守の答え $K_B$ （Bと言う）。
    *   $P(K_B | S_A) = 1/2$ （Aが助かるならB, Cどちらを言ってもよい）。
    *   $P(K_B | S_B) = 0$ （Bが助かるならBとは言えない）。
    *   $P(K_B | S_C) = 1$ （Cが助かるならBと言うしかない）。
    *   $P(K_B) = (1/3)(1/2) + (1/3)(0) + (1/3)(1) = 1/6 + 1/3 = 1/2$。
    *   $P(S_A | K_B) = (1/6) / (1/2) = 1/3$。
17. **0.45** ... 訂正
    *   $P(A \cup B) = P(A) + P(B) - P(A \cap B)$。
    *   独立と仮定するなら $P(A \cap B) = 0.06$。
    *   $P(\text{故障}) = 0.2 + 0.3 - 0.06 = 0.44$。
    *   $P(A | \text{故障}) = P(A \cap \text{故障}) / P(\text{故障}) = P(A) / P(\text{故障}) = 0.2 / 0.44 = 20/44 = 5/11 \approx 0.45$。
    *   (故障の原因がAである確率、つまりAが起きている確率。
    *   答え: 5/11。
    *   解説修正: **5/11**)
18. **解説**
    *   圧倒的多数の「健康な人」の1%（偽陽性）は、ごく少数の「病気の人」の99%（真陽性）よりも数が多くなるため。
19. **約 61.5% (8/13)**
    *   $P(N) = 0.5, P(I) = 0.5$。
    *   $P(\text{表}) = 0.5 \times 0.5 + 0.5 \times 0.8 = 0.25 + 0.4 = 0.65$。
    *   $P(I | \text{表}) = 0.4 / 0.65 = 40/65 = 8/13 \approx 0.615$。
20. **ラプラススムージング**

